# Проект YaMDb 

![CI](https://github.com/Maratagliullin/yamdb_final/actions/workflows/yamdb_workflow.yaml/badge.svg?access_token=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)

Проект расположен по адресу http://yandexpracticum.hopto.org/

Проект YaMDb собирает отзывы (Review) пользователей на произведения (Titles). Произведения делятся на категории: «Книги», «Фильмы», «Музыка». Список категорий (Category) может быть расширен администратором (например, можно добавить категорию «Изобразительное искусство» или «Ювелирка»).

Сами произведения в YaMDb не хранятся, здесь нельзя посмотреть фильм или послушать музыку.

В каждой категории есть произведения: книги, фильмы или музыка. Например, в категории «Книги» могут быть произведения «Винни-Пух и все-все-все» и «Марсианские хроники», а в категории «Музыка» — песня «Давеча» группы «Насекомые» и вторая сюита Баха.

Произведению может быть присвоен жанр (Genre) из списка предустановленных (например, «Сказка», «Рок» или «Артхаус»). Новые жанры может создавать только администратор.

Благодарные или возмущённые пользователи оставляют к произведениям текстовые отзывы (Review) и ставят произведению оценку в диапазоне от одного до десяти (целое число); из пользовательских оценок формируется усреднённая оценка произведения — рейтинг (целое число). На одно произведение пользователь может оставить только один отзыв.  

## Техническое описание проекта YaMDb
К проекту по адресу http://127.0.0.1/redoc/ подключена документация API YaMDb. В ней описаны возможные запросы к API и структура ожидаемых ответов. Для каждого запроса указаны уровни прав доступа: пользовательские роли, которым разрешён запрос.

## Ресурсы API YaMDb
#### Ресурс **auth**: аутентификация. 
Алгоритм регистрации пользователей и выдачи токенов описан в документации адресу http://127.0.0.1/redoc/  
#### Ресурс **users**: пользователи.  
Алгоритм добавления, получения, изменения пользователей описан в документации адресу http://127.0.0.1/redoc/  

#### Ресурс **titles**: произведения, к которым пишут отзывы (определённый фильм, книга или песенка).   
**Получение списка всех произведений:**  
Тип запроса **GET**,  http://127.0.0.1/api/v1/titles/  
Права доступа: **Доступно без токена**  

**Пример ответа:**
```json
[
  {
    "count": 0,
    "next": "string",
    "previous": "string",
    "results": [
      {
        "id": 0,
        "name": "string",
        "year": 0,
        "rating": 0,
        "description": "string",
        "genre": [
          {
            "name": "string",
            "slug": "string"
          }
        ],
        "category": {
          "name": "string",
          "slug": "string"
        }
      }
    ]
  }
]
```

**Добавление произведения:**  
Тип запроса **POST**,  http://127.0.0.1/api/v1/titles/  
Права доступа: **Администратор**  

**Параметры запроса:**  
**name** - Название (тип строка, обязательное)  
**year** - Год выпуска (тип число, обязательное)   
**description**	- Описание (тип строка)  
**genre** - Slug жанра (тим срока, массив строк, обязательное)  
**category** - Slug категории (тип строка, обязательное)   

**Пример ответа:**
```json
{
  "id": 0,
  "name": "string",
  "year": 0,
  "rating": 0,
  "description": "string",
  "genre": [
    {
      "name": "string",
      "slug": "string"
    }
  ],
  "category": {
    "name": "string",
    "slug": "string"
  }
}
```

**Подерживаются следующие типы операций:**  
Получение списка всех произведений  
Добавление произведения  
Получение информации о произведении  
Частичное обновление информации о произведении  
Удаление произведения  

#### Ресурс **categories**: категории (типы) произведений («Фильмы», «Книги», «Музыка»).  
**Получение списка всех категорий:**  
Тип запроса **GET**,  http://127.0.0.1/api/v1/categories/  
Права доступа: **Доступно без токена**  

**Пример ответа:**
```json
[
  {
    "count": 0,
    "next": "string",
    "previous": "string",
    "results": [
      {
        "name": "string",
        "slug": "string"
      }
    ]
  }
]
```

**Добавление новой категории:**  
Тип запроса **POST**, http://127.0.0.1/api/v1/categories/  
Права доступа: **Администратор**  

**Параметры запроса:**  
**slug** - Slug категории  (тип строка, обязательное)  
**name** - Наименование категории  (тип строка, обязательное)  

**Пример ответа:**
```json
{
  "name": "string",
  "slug": "string"
}
```

**Подерживаются следующие типы операций:**  
Получение списка всех категорий  
Добавление новой категории  
Удаление категории  

#### Ресурс **genres**: жанры произведений. Одно произведение может быть привязано к нескольким жанрам.  
Тип запроса **GET**,  http://127.0.0.1/api/v1/genres/  
Права доступа: **Доступно без токена**  

**Пример ответа:**
```json
[
  {
    "count": 0,
    "next": "string",
    "previous": "string",
    "results": [
      {
        "name": "string",
        "slug": "string"
      }
    ]
  }
]
```

**Добавление жанра:**  
Тип запроса **POST**, http://127.0.0.1/api/v1/genres/  
Права доступа: **Администратор**  

**Параметры запроса:**  
**slug** - Slug жанра  (тип строка, обязательное)  
**name** - Наименование жанра  (тип строка, обязательное)

**Пример ответа:**
```json
{
  "name": "string",
  "slug": "string"
}
```

**Подерживаются следующие типы операций:**  
Получение списка всех жанров  
Добавление жанра   
Удаление жанра   

#### Ресурс **reviews**: отзывы на произведения. Отзыв привязан к определённому произведению.  
**Получение списка всех отзывов:**  
Тип запроса **GET**,  http://127.0.0.1/api/v1/titles/{title_id}/reviews/  
Права доступа: **Доступно без токена**  

**Пример ответа:**
```json
[
  {
    "count": 0,
    "next": "string",
    "previous": "string",
    "results": [
      {
        "id": 0,
        "text": "string",
        "author": "string",
        "score": 1,
        "pub_date": "2019-08-24T14:15:22Z"
      }
    ]
  }
]
```

**Добавление нового отзыва:**  
Тип запроса **POST**, http://127.0.0.1/api/v1/titles/{title_id}/reviews/  
Права доступа: **Аутентифицированные пользователи**  

**Параметры запроса:**  
**title_id** - ID произведения (тип число, обязательное)  
**text** - Текст отзыва (тип строка, обязательное)  
**score** - Оценка [ 1 .. 10 ] (тип число, обязательное)  

**Пример ответа:**
```json
{
  "id": 0,
  "text": "string",
  "author": "string",
  "score": 1,
  "pub_date": "2019-08-24T14:15:22Z"
}
```

**Подерживаются следующие типы операций:**  
Получение списка всех отзывов  
Добавление нового отзыва  
Полуение отзыва по id  
Частичное обновление отзыва по id  
Удаление отзыва по id  

#### Ресурс **comments**: комментарии к отзывам. Комментарий привязан к определённому отзыву.
**Получение списка всех комментариев к отзыву:**  
Тип **GET**, http://127.0.0.1/api/v1/titles/{title_id}/reviews/{review_id}/comments/  
Права доступа: **Доступно без токена**  

**Параметры запроса:**  
**title_id** - ID произведения (тип строка, обязательное)  
**review_id** - ID отзыва (тип число, обязательное)

**Пример ответа:**
```json
[
  {
    "count": 0,
    "next": "string",
    "previous": "string",
    "results": [
      {
        "id": 0,
        "text": "string",
        "author": "string",
        "pub_date": "2019-08-24T14:15:22Z"
      }
    ]
  }
]
```

**Добавление комментария к отзыву:**  
Тип **POST**, http://127.0.0.1/api/v1/titles/{title_id}/reviews/{review_id}/comments/  
Права доступа: **Аутентифицированные пользователи**  

**Параметры запроса:**    
**title_id** - ID произведения (тип строка, обязательное)  
**review_id** - ID отзыва (тип число, обязательное)  
**text** - Текст комментария (тип строка, обязательное)  

**Пример ответа:**
```json
{
  "id": 0,
  "text": "string",
  "author": "string",
  "pub_date": "2019-08-24T14:15:22Z"
}
```

**Подерживаются следующие типы операций:**  
Получение списка всех комментариев к отзыву  
Добавление комментария к отзыву  
Получение комментария к отзыву  
Частичное обновление комментария к отзыву  
Удаление комментария к отзыву  

**Каждый ресурс описан в документации: указаны эндпоинты (адреса, по которым можно сделать запрос), разрешённые типы запросов, права доступа и дополнительные параметры, если это необходимо.**

## Инструкция
### Предварительные действия:
Установка Docker - официальное руководство: https://docs.docker.com/get-docker/

Корректность установки необходимо проверить командой в терминале:

 ```docker --version```  

**Вывод:**  
 ```
Docker version 20.10.14, build a224086, build f0df350 - версия докер и номер сборки может отличаться
 ```
Установка Docker-compose - официальное руководство:  https://docs.docker.com/compose/

Корректность установки необходимо проверить командой в терминале:

 ```docker-compose --version ```  

**Вывод:**  
 ```
 Docker Compose version v2.0.0-beta.6   
 ```

### Локальный запуск проекта:

Расположение проекта на github: https://github.com/Maratagliullin/yamdb_final


Необходимо склонировать репозиторий перейти в директорию проекта (дирректория infra) и запустить сборку командой:

```docker-compose build```  

Запуск проекта (команда):

```docker-compose up -d```  

### Перечень доступных команд управления приложением:  
**Заполнение приложения тестовыми данными:**  
В дирректории проекта расположен дамп(```db.json```) с тестовыми данными в формате json, при необходимости вы можете наполнить проект данными командой:  

```docker-compose exec web python3 manage.py loaddata db.json```, где ```db.json``` имя файла дампа

После импорта дампа вам необходимо вручную создать суперпользователя Django командой:  

```docker-compose exec web python manage.py createsuperuser```

##### Интерфейсы приложения:
Административный интерфейс Django:   
http://localhost/admin

Документация API YaMDb:  
http://localhost/redoc/

Учетные данные к сервисам расположены в .env файле в директории проекта. Фаил .env необходимо создать в диррктории infra и заполнить самостоятельно.  

### Пример переченя переменных окружения:     
#####  Движок базы данных:
**DB_ENGINE**=django.db.backends.postgresql
##### Имя базы данных:
**DB_NAME**=postgres 
##### Логин для подключения к базе данных:
**POSTGRES_USER**=postgres 
##### Пароль для подключения к БД (установите свой):
**POSTGRES_PASSWORD**=postgres 
##### Название сервиса (контейнера):
**DB_HOST**=db 
##### Порт для подключения к БД: 
**DB_PORT**=5432 
##### Имя суперпользователя (установите свой):
**DJANGO_SUPERUSER_USER**=administrator
##### Email суперпользователя (установите свой):
**DJANGO_SUPERUSER_EMAIL**=admin@admin.ru
##### Пароль суперпользователя (установите свой):
**DJANGO_SUPERUSER_PASSWORD**=adminpass
##### Пример секретного ключа django, 50 знаков (установите свой): 
**SECRET_KEY**=p&l%385148kslhtyn^##a1)ilz@4zqj=rq&agdol^##zgl9(vs 
